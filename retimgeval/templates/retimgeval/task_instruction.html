{% extends 'base.html' %}

{% block title %}{{ task.name }}{% endblock title %}

{% block content %}

{% if user.is_authenticated %}

    {% if task.alias == "realism-fundus" %}
    <h1>Realism of AI-generated fundus images</h1>
    <h3>Instruction</h3>
    <ul>
        <li>
            You will be shown a set of three fundus images scans labelled as <b>a</b>, <b>b</b>, and <b>c</b>.
        </li>
        <li>
            The images will be shown for <b>20</b>s. The images will be hidden after the completion of the time limit.
        </li>
        <li>
            In each panel, two of these images have been taken from real patients, one has been generated by an AI.
        </li>
        <li>
            Select the label corresponding to the image generated by the AI.
        </li>
    </ul>
    {% endif %}

    {% if task.alias == "realism-fundus-grading-no-support" or task.alias == "realism-fundus-grading-without-support-2" %}
    
        {% if task.alias == "realism-fundus-grading-no-support" %}
            <h1>Grading of DR without decision support</h1>
        {% elif task.alias == "realism-fundus-grading-without-support-2" %}
            <h1>Grading of DR</h1>
        {% endif %}
        <h3>Instruction</h3>
        <ul>
            <li>
                You will be shown a <b>single</b> fundus image.
            </li>
            <li>
                Decide whether the patient shows signs of referable Diabetic Retinopathy (DR), i.e. moderate, severe, or proliferative DR.
            </li>
            <li>
                Additionally, rate the confidence of your decision on a scale of 1 (least confident) to 10 (most confident).
            </li>
            <li>
                If you move your mouse over a region in the image, you are shown a zoomed version of that image region.
            </li>
            <li>
                We record the time you take to reach your decision.
            </li>
        </ul>
    {% endif %}

    {% if task.alias == "realism-fundus-grading-with-support" %}
    <h1>Grading of DR with decision support</h1>
    <h3>Instruction</h3>
    <ul>
        <li>
            You will be shown <b>three</b> fundus images for each patient.
        </li>
        <li>
            The image in the center is the fundus image taken from the patient. The image on the left is a healthier version of the original image generated by our AI. The image on the right is a more diseased version of the original image also generated by our AI.
        </li>
        <li>
            Decide whether the patient shows signs of referable Diabetic Retinopathy (DR), i.e. moderate, severe, or proliferative DR.
        </li>
        <li>
            Additionally, rate the confidence of your decision on a scale of 1 (least confident) to 10 (most confident).
        </li>
        <li>
            If you move your mouse over a region in the image, you are shown a zoomed version of that image region.
        </li>
        <li>
            We record the time you take to reach your decision.
        </li>
    </ul>
    {% endif %}

    {% if task.alias == "realism-oct" %}
    <h1>Realism of AI-generated Optical Coherence Tomography (OCT) images</h1>
    <h3>Instructions</h3>
        <ul>
            <li>You will be shown a set of three OCT images labelled as a, b, and c.</li>
            <li>The images will be shown for <b>20</b>s. The images will be hidden after the completion of the time limit.</li>
            <li>In each panel, two of these images have been taken from real patients, one has been generated by an AI.</li>
            <li>Select the label corresponding to the image generated by the AI.</li>
        </ul>
    {% endif %}

    {% if task.alias == "bagnet-grading-no-support" %}
    <h1>Grading of DR without decision support from AI</h1>
    <h3>Instruction </h3>
    <ul>
        <li>
            You will be shown a single fundus image.
        </li>
        <li>
            Based on the image, decide whether the patient has Diabetic Retinopathy (DR) of any severity, including mild DR.
        </li>
        <li>
            Additionally, rate the confidence of your decision on a scale of 1 (least confident) to 5 (most confident).
        </li>
        <li>
            If you move your mouse over a region in the image, you are shown a zoomed version of that image region.  
        </li>
        <li>
            We record the time you take to reach your decision. 
        </li>
    </ul>
    {% endif %}

    {% if task.alias == "bagnet-grading-with-ai-support" %}
    <h1>Grading of DR with decision support from AI</h1>
    <h3>Instruction</h3>
    <ul>
        <li>
            You will be shown a single fundus image along with an AI model’s decision and confidence in percent (from 0% to 100%, with 100% being the highest confidence score).        
        </li>
        <li>
            Based on the image, decide whether the patient has Diabetic Retinopathy (DR) of any severity, including mild DR.        
        </li>
        <li>
            Additionally, rate the confidence of your decision on a scale of 1 (least confident) to 5 (most confident).        
        </li>
        <li>
            If you move your mouse over a region in the image, you are shown a zoomed version of that image region.        
        </li>
        <li>
            We record the time you take to reach your decision.
        </li>
    </ul>
    {% endif %}

    {% if task.alias == "bagnet-grading-with-ai-support-and-bounding-boxes" %}
    <h1>
        Grading of DR with decision support and explanations from AI
    </h1>
    <h3>
        Instruction
    </h3>
    <ul>
        <li>
            You will be shown a single fundus image along with an AI model’s decision and confidence in percent (from 0% to 100%, with 100% being the highest confidence score).
        </li>
        <li>
            Regions in the image for which the AI model believes that they contain signs of DR will be highlighted by blue boxes. Be aware that some boxes may be erroneously placed and may not contain real lesions. Also, not all lesions are flagged.
        </li>
        <li>
            Based on the image, decide whether the patient has Diabetic Retinopathy (DR) of any severity, including mild DR.
        </li>
        <li>
            Additionally, rate the confidence of your decision on a scale of 1 (least confident) to 5 (most confident).
        </li>
        <li>
            If you move your mouse over a region in the image, you are shown a zoomed version of that image region.
        </li>
        <li>
            We record the time you take to reach your decision. 
        </li>
    </ul>
    {% endif %}

    {% if task.alias == "erm-oct" %}
    <h1>
        ERM Detection for OCT
    </h1>
    <h3>
        Instruction
    </h3>
    <ul>
        <li>
            You will be shown 37 OCT images, with corresponding heatmaps created by our model and with magnified patches extracted from the heatmaps. 
        </li>
        <li>
            These images are either healthy or contain ERMs. Your task is to select whether you agree with the heatmaps overlaid on the OCT images.
        </li>
    </ul>
    {% endif %}

    {% if task.alias == "erm-macula" %}
    
    <div class="fs-3 fw-bold mb-3">Instruction</div> 

    <div class="fs-5 fw-semibold mt-3 mb-2" >Objectives</div> 
    
    <div>
        This study aims to determine whether specific areas (patches) of medical images show evidence of Epiretinal Membrane (ERM), as identified by a heatmap generated by a model. Your task is to evaluate these patches and indicate whether you agree with the model's identification.
    </div>

    <div class="fs-5 fw-semibold mt-3 mb-2" >Study Layout</div>
    <div>
        On each page, you will be shown an OCT image (on the left) with a corresponding overlaid heatmap and bounding boxes (on the right). The heatmap highlights regions of where the model detected potential evidence of ERM. Below them are individually numbered patches for easy reference of the overlaid heatmap. You will be shown 40 OCT images. 
    </div>

    <div class="fs-5 fw-semibold mt-3 mb-2" >Your Task</div>
    <div>
        Your task will be to review each patch displayed and provide your assessment by choosing whether the patch contain ERM or not. 
        
        <ul>
            <li>
                <b>Yes</b>: indicates that you agree the patch contains evidence of ERM.
            </li>
            <li>
                <b>No</b> indicates that you do not agree the patch contains evidence of ERM.
            </li>
            <li>
                <b>Not sure</b> indicates that you are uncertain whether the patch contains evidence of ERM.
            </li>
        </ul>
    </div>

    {% endif %}

    {% if not already_consented %}
        <form method="post">
            <h3>Information about the study</h3>
            <p>
                Your answers will be saved on a secure server in the EU and will be used to assess the quality of an AI algorithm. If you have additional questions, do not hesitate to ask. No personal information or information about the quality of your answers will be disclosed at any time to anyone, in particularly it will not be shared with your employer. Please check "consent" below if you agree to these terms.
            </p>
            {% csrf_token %}
            {{ form.non_field_errors }}
            {{ form.consented.errors }}
            <label>{{ form.consented.label_tag }} {{ form.consented }} </label>
            <br/>
            <button type="submit" id="start-btn" class="btn btn-primary">Start</button>
        </form>
    {% else %}
        <button id="start-btn" class="btn btn-primary">Start</button>
        
        <script>
            document.getElementById("start-btn").addEventListener("click", function() {
                window.location.href = "{{ task.get_absolute_url }}";
            });
        </script>

    {% endif %}

{% else %}

<p>You are not logged in yet.</p>

{% endif %}

{% endblock content %}
